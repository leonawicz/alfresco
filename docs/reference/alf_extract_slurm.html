<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Slurm script for ALFRESCO data extractions — alf_extract_slurm â€¢ alfresco</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  <link href="../extra.css" rel="stylesheet">
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Google analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46129458-3', 'auto');
  ga('send', 'pageview');

</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">alfresco</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/alfresco.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/fire_prob.html">Fire point probability</a>
    </li>
    <li>
      <a href="../articles/jfsp_extract.html">JFSP data extraction</a>
    </li>
    <li>
      <a href="../articles/jfsp_hist_fmo_tx.html">JFSP fire management treatments</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-globe fa-lg"></span>
     
    SNAPverse
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://leonawicz.github.io/sv.html">Home of the verse</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Sector packages</li>
    <li>
      <a href="https://leonawicz.github.io/snapverse">snapverse</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snaplite">snaplite</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapdata">snapdata</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapwebs">snapwebs</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Functions packages</li>
    <li>
      <a href="https://leonawicz.github.io/snapstat">snapstat</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapplot">snapplot</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snaplocs">snaplocs</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapprep">snapprep</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/alfresco">alfresco</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data packages</li>
    <li>
      <a href="https://leonawicz.github.io/snapclim">snapclim</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapfire">snapfire</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snappoly">snappoly</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapgrid">snapmaps</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapdist">snapdist</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Apps &amp; docs packages</li>
    <li>
      <a href="https://leonawicz.github.io/snapapps">snapapps</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapdash">snapdash</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapflex">snapflex</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapdocs">snapdocs</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Satellite packages</li>
    <li>
      <a href="https://leonawicz.github.io/rvtable">rvtable</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/apputils">apputils</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/maputils">maputils</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snaputils">snaputils</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapmeta">snapmeta</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapsite">snapsite</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/leonawicz/alfresco">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Slurm script for ALFRESCO data extractions</h1>
    </div>

    
    <p>Generate slurm script for ALFRESCO data extractions from output maps.</p>
    

    <pre class="usage"><span class='fu'>alf_extract_slurm</span>(<span class='kw'>out_dir</span> <span class='kw'>=</span> <span class='fu'><a href='alfdef.html'>alfdef</a></span>()$<span class='no'>alf_slurm_dir</span>, <span class='kw'>file</span> <span class='kw'>=</span> <span class='st'>"alf_extract.R"</span>,
  <span class='no'>ntasks</span>, <span class='no'>nodes</span>, <span class='no'>ntasks_per_node</span>, <span class='kw'>exclusive</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>domain</span> <span class='kw'>=</span> <span class='st'>"akcan1km"</span>,
  <span class='kw'>rmpi</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>modelIndex</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>project</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>years</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>reps</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>cru</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>repSample</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>locgroup</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>email</span> <span class='kw'>=</span> <span class='st'>"mfleonawicz@alaska.edu"</span>, <span class='kw'>partition</span> <span class='kw'>=</span> <span class='st'>"main"</span>,
  <span class='kw'>copy_rscript</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>max_cores</span> <span class='kw'>=</span> <span class='fl'>32</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>out_dir</th>
      <td><p>the directory containing <code>file</code>. This is where the slurm script is to be saved and executed from.</p></td>
    </tr>
    <tr>
      <th>file</th>
      <td><p>the R script to be called by <code>Rscript</code> when the generated slurm script is executed.
May be similarly generated by this function. See <code>copy_rscript</code> below.</p></td>
    </tr>
    <tr>
      <th>ntasks</th>
      <td><p>numeric, SLURM number of tasks. See details.</p></td>
    </tr>
    <tr>
      <th>nodes</th>
      <td><p>numeric, SLURM number of compute nodes. See details.</p></td>
    </tr>
    <tr>
      <th>ntasks_per_node</th>
      <td><p>numeric, SLURM number of tasks per node. See details.</p></td>
    </tr>
    <tr>
      <th>exclusive</th>
      <td><p>logical, put nodes into exclusive use for the job when the generated slurm script is executed. Defaults to <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>domain</th>
      <td><p>character, the ALFRESCO run spatial domain, either <code>"akcan1km"</code> or <code>"ak1km"</code>.</p></td>
    </tr>
    <tr>
      <th>rmpi</th>
      <td><p>logical, use <code>Rmpi</code>, defaults to <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>modelIndex</th>
      <td><p>integer, iterator, refers to the position in the list of a project's ALFRESCO model run GCM/RCP output directories.</p></td>
    </tr>
    <tr>
      <th>project</th>
      <td><p>character, a (new) project name for extracted data. It need not match any directory names pertaining to the raw ALFRESCO outputs.</p></td>
    </tr>
    <tr>
      <th>years</th>
      <td><p>numeric vector of years for data extraction.</p></td>
    </tr>
    <tr>
      <th>reps</th>
      <td><p>numeric vector of ALFRESCO simulation replicates for data extraction, e.g. <code>1:200</code>.</p></td>
    </tr>
    <tr>
      <th>cru</th>
      <td><p>logical, whether data extraction is for historical years (ALFRESCO runs based on CRU data) or projected years (GCM data).</p></td>
    </tr>
    <tr>
      <th>repSample</th>
      <td><p>optional numeric vector of reps for subsampling, e.g., <code>1:30</code>.</p></td>
    </tr>
    <tr>
      <th>locgroup</th>
      <td><p>optional character string naming a specific Location Group to process extraction for instead of all Location Groups.</p></td>
    </tr>
    <tr>
      <th>email</th>
      <td><p>defaults to the author/maintainer/user.</p></td>
    </tr>
    <tr>
      <th>partition</th>
      <td><p>defaults to <code>"main"</code>.</p></td>
    </tr>
    <tr>
      <th>copy_rscript</th>
      <td><p>logical, also copy template R script from <code>alfresco</code> package along with the generated slurm script. Defaults to <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>max_cores</th>
      <td><p>maximum number of processors to use on a single Atlas node, defaults to 32.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function is used for generating a slurm script that is used for extracting data from ALFRESCO geotiff map outputs for subsequent analyses.
The generated slurm script leverages <code>Rmpi</code> for multi-node cluster processing.
It is used to call an R script with <code>Rscript</code>, e.g., that created by <a href='alf_extract_rscript.html'>alf_extract_rscript</a>.
The scripts are typically used in this fashion, but they can also be generating with <code>rmpi = FALSE</code>, in which case <code>nodes</code>
need only be 1.</p>
<p>Formal SLURM job arguments are passed by <code>ntasks</code>, <code>nodes</code>, <code>ntasks_per_node</code>, <code>exclusive</code>, <code>email</code> and <code>partition</code>.
General script setup arguments include <code>out_dir</code>, <code>file</code>, <code>copy_rscript</code> and <code>max_cores</code>.
All other arguments refer to those passed to the <code>Rscript</code> call within the slurm script.
Any of these that are <code>NULL</code> are ignored and it is assumed they will be passed explicitly as name-value pairs (in any order)
at the command line by the user when the generated slurm script is executed.
Any of these arguments that are not <code>NULL</code> are hardcoded into the string of arguments listed after <code>Rscript</code>.</p>
<p>This provides flexible generality when generating ALFRESCO data extraction slurm scripts.
Note that the number of non-null arguments among these decreases the number of available general arguments available at the command line
when the script is executed. For example, if seven of the nine arguments available to <code>Rscript</code> are hardcoded into the slurm
script by passing them to <code>alf_extract_slurm</code> explicitly, then the generated script will show only an additional <code>$1 $2</code>
after the fixed arguments rather than <code>$1 $2... $9</code>.</p>
<p>If <code>years</code> is missing, then the formal SLURM job arguments <code>ntasks</code>, <code>nodes</code> and <code>ntasks_per_node</code>
must be provided and it is assumed that a year range that matches the number of tasks will be provided when the slurm script is executed.
These arguments are always intended to be hardcoded into a generated script.</p>
<p>Alternatively, if <code>years</code> is provided explicitly, then if these job arguments are missing they can be inferred internally
based on the number of years to be processed using the script and the <code>max_cores</code> to be used per node.
Since these scripts are run on SNAP's Atlas cluster, the default <code>max_cores</code> is 32.
This can be lowered for intensive extraction jobs that
may reach node RAM limits otherwise.</p>
<p>Note that this function is intended to be run on the Atlas cluster. If you make a bash script like this on Windows,
you may have to run a command line utility like <code>dos2unix</code> on the file.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='fu'>alf_extract_slurm</span>(
  <span class='kw'>domain</span> <span class='kw'>=</span> <span class='st'>"ak1km"</span>, <span class='kw'>project</span> <span class='kw'>=</span> <span class='st'>"JFSP"</span>, <span class='kw'>years</span> <span class='kw'>=</span> <span class='fl'>1950</span>:<span class='fl'>2013</span>,
  <span class='kw'>reps</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>32</span>, <span class='kw'>cru</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>
)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://leonawicz.github.io/'>Matthew Leonawicz</a>, <a href='http://snap.uaf.edu/'><img src="https://raw.githubusercontent.com/leonawicz/leonawicz.github.io/master/assets/img/snap_symbol.svg?sanitize=true" height="24" />  Scenarios Network for Alaska and Arctic Planning</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
